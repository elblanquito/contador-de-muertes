<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lectura en Tiempo Real</title>
</head>

<script>
  const muerte = new Audio("./resources/sounds/muerte.mp3");
  const revertir = new Audio("./resources/sounds/revertir.mp3");
  let previousValue = null;

  async function fetchData() {
    const response = await fetch('/data');
    const data = await response.json();
    const numero = document.getElementById('numero');
    const box = document.querySelector('.box');
    
    if (data.contador !== previousValue) {
      if (previousValue !== null) {
        // Añade clases para animaciones
        box.classList.add('animate-flash')
        numero.classList.add('animate-pop');
        // Elimina las clases después de la animación
        setTimeout(() => {
          box.classList.remove('animate-flash')
          numero.classList.remove('animate-pop')
        }, 400);
        if (data.contador > previousValue){
          muerte.currentTime = 0; 
          muerte.play();
        } else if (data.contador < previousValue){
          revertir.currentTime = 0; 
          revertir.play();
        }
      } 
    previousValue = data.contador;
    numero.textContent = isNaN(data.contador) ? "-" : data.contador;
    forceRedraw(numero);
  }
  }
  setInterval(fetchData, 200); // Llama a fetchData cada segundo
  fetchData(); // Llamada inicial para cargar el contenido

  function forceRedraw(element) {
  // Truco para forzar el redibujado
  element.style.display = 'none';
  element.offsetHeight; // Fuerza el recálculo de estilos
  element.style.display = '';
}
</script>

<body class="cont">
  <div class="box">
    <h1 class="titulo">MUERTES:</h1>
    <div id="numero">0</div>
  </div>
  <div class="rgb-border"></div>
  
</body>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap');
    @font-face {
      font-family: 'determination';
      src: url('resources/fonts/determination.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
        @font-face {
      font-family: 'MERCY';
      src: url('fonts/MERCY.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }


    * {
    font-family: 'MERCY', monospace;
    font-size: large;
    margin: 5px;
    text-shadow:
    4px 4px 0 #000,
    -4px 4px 0 #000,
    -3px -3px 0 #000,
    3px -3px 0 #000;
    letter-spacing: 0.2rem;
    text-align: center;
    user-select: none;
    margin: 0px;
    padding: 0px;
    line-height: 1.0;
    }
    .cont{
      background-color: rgb(0, 220, 0);
      
      height: 100vh;
      display: flex;
    }
    .box{
      position: relative;
      background-color: rgb(0, 0, 0);
      border-radius: 0px;
      border: 12px solid #ff7f27;
      color: #ff7f27;
      margin: auto;
      width: min-content; 
      /*
      box-shadow: inset 0px 0px 10px 5px rgb(255, 255, 255);
      */
      padding: 30px 60px;
      display: flex;
      flex-direction: row;
      gap: 20px
    }
    
    .titulo{
      font-size: 90px;
      width: max-content;
    }

    #numero{
      font-family: 'determination';
      font-size: 110px;
      font-weight: bolder;
      transition: all ease 0.5s;
      width: min-content;
      margin: auto; 
      margin-bottom: -7px;
      color: #ffff00;
    }
    .animate-pop {
      animation: pop 0.4s ease;
    }

    @keyframes pop {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.5) rotate(10deg);
      }
      100% {
        transform: scale(1);
      }
    }

  .animate-flash{
    animation: flash 0.4s ease;
  }
  @keyframes flash {
    0% {
      border-color:#ff7f27;
      color: #ff7f27;
    }
    50% {
      border-color:#ffff00;
      color: #ffff00 ;
    }
    100% {
      border-color:#ff7f27;
      color: #ff7f27;
    }
  }

    
  </style>

</html>
